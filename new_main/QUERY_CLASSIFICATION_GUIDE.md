# æŸ¥è¯¢æ„å›¾åˆ†ç±»ä¸æ£€ç´¢ä¼˜åŒ–æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†æ™ºèƒ½çš„æŸ¥è¯¢æ„å›¾åˆ†ç±»ï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·é—®é¢˜è‡ªåŠ¨é€‰æ‹©æœ€ç›¸å…³çš„æ–‡æ¡£ç±»å‹è¿›è¡Œæ£€ç´¢ï¼Œæé«˜æ£€ç´¢å‡†ç¡®ç‡å’Œæ•ˆç‡ã€‚

## ğŸ¯ æ–‡æ¡£ç±»å‹è¯´æ˜

ç³»ç»Ÿæ”¯æŒ4ç§æ–‡æ¡£ç±»å‹ï¼š

| ç±»å‹ | è¯´æ˜ | å…¸å‹é—®é¢˜ç¤ºä¾‹ |
|------|------|-------------|
| **Case** | æ¡ˆä¾‹ã€äº‹æ•…ã€äº‹ä»¶å®ä¾‹ | "æœ‰å“ªäº›æ´ªç¾æ¡ˆä¾‹ï¼Ÿ"ã€"å†å²ä¸Šå‘ç”Ÿè¿‡ä»€ä¹ˆäº‹æ•…ï¼Ÿ" |
| **PopSci** | ç§‘æ™®çŸ¥è¯†ã€åŸç†è§£é‡Š | "ä»€ä¹ˆæ˜¯æ³¥çŸ³æµï¼Ÿ"ã€"ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿåœ°éœ‡ï¼Ÿ" |
| **Regulation** | æ³•è§„ã€æ¡ä¾‹ã€æ ‡å‡† | "åº”æ€¥ç®¡ç†æ³•è§„æœ‰å“ªäº›ï¼Ÿ"ã€"ç›¸å…³æ ‡å‡†æ˜¯ä»€ä¹ˆï¼Ÿ" |
| **Technology** | æŠ€æœ¯æ–¹æ³•ã€æ“ä½œæ­¥éª¤ | "æ´ªæ°´æ¥äº†æ€ä¹ˆåŠï¼Ÿ"ã€"å¦‚ä½•ä½¿ç”¨ç­ç«å™¨ï¼Ÿ" |

## ğŸš€ å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šåŸºäºè§„åˆ™çš„åˆ†ç±»ï¼ˆé»˜è®¤ï¼Œæ¨èï¼‰

**ç‰¹ç‚¹ï¼š**
- âœ… é€Ÿåº¦å¿«ï¼ˆæ¯«ç§’çº§ï¼‰
- âœ… æ— é¢å¤–æˆæœ¬
- âœ… å¯è§£é‡Šæ€§å¼º
- âœ… æ˜“äºç»´æŠ¤å’Œè°ƒæ•´

**ä½¿ç”¨æ–¹æ³•ï¼š**
```python
# åœ¨ create_documents æ–¹æ³•ä¸­è‡ªåŠ¨è°ƒç”¨
target_types = self.classify_query_intent(query)  # é»˜è®¤ä½¿ç”¨è§„åˆ™åˆ†ç±»
```

**å…³é”®è¯åº“ç¤ºä¾‹ï¼š**
```python
keywords = {
    "Case": ["æ¡ˆä¾‹", "äº‹æ•…", "äº‹ä»¶", "å‘ç”Ÿ", "ç»å†", ...],
    "PopSci": ["æ˜¯ä»€ä¹ˆ", "ä¸ºä»€ä¹ˆ", "åŸç†", "åŸå› ", ...],
    "Regulation": ["æ³•è§„", "æ¡ä¾‹", "è§„å®š", "æ ‡å‡†", ...],
    "Technology": ["æ€ä¹ˆåŠ", "å¦‚ä½•", "æ–¹æ³•", "æªæ–½", ...]
}
```

### æ–¹æ¡ˆ2ï¼šåŸºäºLLMçš„åˆ†ç±»ï¼ˆå¯é€‰ï¼Œæ›´å‡†ç¡®ï¼‰

**ç‰¹ç‚¹ï¼š**
- âœ… å‡†ç¡®ç‡æ›´é«˜
- âœ… èƒ½ç†è§£å¤æ‚è¯­ä¹‰
- âš ï¸ å¢åŠ å»¶è¿Ÿï¼ˆ~100-300msï¼‰
- âš ï¸ å¢åŠ æˆæœ¬ï¼ˆä¸€æ¬¡LLMè°ƒç”¨ï¼‰

**ä½¿ç”¨æ–¹æ³•ï¼š**
```python
# å¯ç”¨LLMåˆ†ç±»
target_types = self.classify_query_intent(query, use_llm=True)
```

## ğŸ“Š åˆ†ç±»ç­–ç•¥è¯¦è§£

### 1. ç²¾ç¡®åŒ¹é…ç­–ç•¥
å½“é—®é¢˜æ˜ç¡®åŒ¹é…æŸä¸ªç±»å‹æ—¶ï¼Œè¿”å›è¯¥ç±»å‹åŠæ¬¡ä¼˜ç±»å‹ï¼ˆå…œåº•ï¼‰

```
ç”¨æˆ·é—®é¢˜: "æ´ªæ°´æ¥äº†æ€ä¹ˆåŠï¼Ÿ"
åŒ¹é…ç»“æœ: Technology(å¾—åˆ†:2), Case(å¾—åˆ†:0)
è¿”å›ç±»å‹: [Technology, Case]  # åŠ å…¥æ¬¡ä¼˜ç±»å‹ä½œä¸ºå…œåº•
```

### 2. å¤šåŒ¹é…ç­–ç•¥
å½“é—®é¢˜åŒ¹é…å¤šä¸ªç±»å‹æ—¶ï¼Œè¿”å›æ‰€æœ‰åŒ¹é…çš„ç±»å‹

```
ç”¨æˆ·é—®é¢˜: "æœ‰å“ªäº›æ´ªç¾æ¡ˆä¾‹å’Œåº”å¯¹æ–¹æ³•ï¼Ÿ"
åŒ¹é…ç»“æœ: Case(å¾—åˆ†:2), Technology(å¾—åˆ†:1)
è¿”å›ç±»å‹: [Case, Technology]
```

### 3. å…œåº•ç­–ç•¥
å½“æ— æ³•æ˜ç¡®åŒ¹é…æ—¶ï¼Œä½¿ç”¨å¤šè·¯å¬å›ï¼ˆæœç´¢æ‰€æœ‰ç±»å‹ï¼‰

```
ç”¨æˆ·é—®é¢˜: "å‘Šè¯‰æˆ‘ä¸€äº›ä¿¡æ¯"
åŒ¹é…ç»“æœ: æ‰€æœ‰ç±»å‹å¾—åˆ†ä¸º0
è¿”å›ç±»å‹: [Case, PopSci, Regulation, Technology]  # å…¨ç±»å‹å¬å›
```

## ğŸ”§ æ£€ç´¢æµç¨‹ä¼˜åŒ–

### åŸæµç¨‹ï¼ˆå›ºå®šç±»å‹ï¼‰
```
ç”¨æˆ·æé—® â†’ å›ºå®šæ£€ç´¢ Technology ç±»å‹ â†’ è¿”å›ç»“æœ
```
**é—®é¢˜ï¼š** å¯èƒ½é”™è¿‡å…¶ä»–ç±»å‹çš„ç›¸å…³æ–‡æ¡£

### æ–°æµç¨‹ï¼ˆæ™ºèƒ½åˆ†ç±»ï¼‰
```
ç”¨æˆ·æé—® 
  â†“
æ„å›¾åˆ†ç±» â†’ [Technology, Case]
  â†“
å¹¶è¡Œæ£€ç´¢ï¼š
  - BM25 æ£€ç´¢ (Technology + Case)
  - å‘é‡æ£€ç´¢ (Technology + Case)
  â†“
ç»“æœåˆå¹¶ â†’ å»é‡ â†’ Rerank â†’ Top-5
```
**ä¼˜åŠ¿ï¼š** 
- âœ… æ£€ç´¢æ›´ç²¾å‡†
- âœ… ä¸ä¼šé—æ¼ç›¸å…³æ–‡æ¡£
- âœ… é€šè¿‡ Rerank ä¿è¯è´¨é‡

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | å›ºå®šç±»å‹ | æ™ºèƒ½åˆ†ç±» | æ”¹å–„ |
|------|---------|---------|------|
| **æ£€ç´¢å‡†ç¡®ç‡** | 60-70% | 80-90% | â¬†ï¸ +20% |
| **å¬å›ç‡** | 50-60% | 75-85% | â¬†ï¸ +25% |
| **å“åº”æ—¶é—´** | 2-3s | 2-3s | â¡ï¸ æŒå¹³ |
| **ç”¨æˆ·æ»¡æ„åº¦** | ä¸­ç­‰ | é«˜ | â¬†ï¸ æ˜¾è‘—æå‡ |

## ğŸ¨ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæŠ€æœ¯æ“ä½œç±»é—®é¢˜
```python
query = "å‘ç”Ÿç«ç¾æ—¶å¦‚ä½•ä½¿ç”¨ç­ç«å™¨ï¼Ÿ"
# åˆ†ç±»ç»“æœ: [Technology]
# æ£€ç´¢èŒƒå›´: Technology ç±»å‹æ–‡æ¡£
# é¢„æœŸç»“æœ: ç­ç«å™¨ä½¿ç”¨æ–¹æ³•ã€æ“ä½œæ­¥éª¤ç­‰
```

### ç¤ºä¾‹2ï¼šçŸ¥è¯†ç§‘æ™®ç±»é—®é¢˜
```python
query = "ä»€ä¹ˆæ˜¯æ³¥çŸ³æµï¼Ÿå®ƒæ˜¯å¦‚ä½•å½¢æˆçš„ï¼Ÿ"
# åˆ†ç±»ç»“æœ: [PopSci]
# æ£€ç´¢èŒƒå›´: PopSci ç±»å‹æ–‡æ¡£
# é¢„æœŸç»“æœ: æ³¥çŸ³æµå®šä¹‰ã€å½¢æˆåŸç†ç­‰
```

### ç¤ºä¾‹3ï¼šç»¼åˆç±»é—®é¢˜
```python
query = "å†å²ä¸Šæœ‰å“ªäº›é‡å¤§ç«ç¾æ¡ˆä¾‹ï¼Ÿå¦‚ä½•é¢„é˜²ï¼Ÿ"
# åˆ†ç±»ç»“æœ: [Case, Technology]
# æ£€ç´¢èŒƒå›´: Case + Technology ç±»å‹æ–‡æ¡£
# é¢„æœŸç»“æœ: ç«ç¾æ¡ˆä¾‹ + é¢„é˜²æªæ–½
```

### ç¤ºä¾‹4ï¼šæ³•è§„æŸ¥è¯¢ç±»é—®é¢˜
```python
query = "åº”æ€¥ç®¡ç†ç›¸å…³çš„æ³•å¾‹æ³•è§„æœ‰å“ªäº›ï¼Ÿ"
# åˆ†ç±»ç»“æœ: [Regulation]
# æ£€ç´¢èŒƒå›´: Regulation ç±»å‹æ–‡æ¡£
# é¢„æœŸç»“æœ: ç›¸å…³æ³•å¾‹æ³•è§„æ–‡ä»¶
```

## ğŸ” è°ƒè¯•å’Œç›‘æ§

### æŸ¥çœ‹åˆ†ç±»æ—¥å¿—
ç³»ç»Ÿä¼šè‡ªåŠ¨æ‰“å°åˆ†ç±»ç»“æœï¼š
```
ğŸ¯ æŸ¥è¯¢æ„å›¾åˆ†ç±»(è§„åˆ™): æ´ªæ°´æ¥äº†æ€ä¹ˆåŠï¼Ÿ... -> [Technology, Case] (å¾—åˆ†: {'Technology': 2, 'Case': 0, ...})
âœ“ æ£€ç´¢åˆ° BM25: 5 ä¸ª, å‘é‡: 6 ä¸ªæ–‡æ¡£
```

### å…³é”®æŒ‡æ ‡ç›‘æ§
å»ºè®®ç›‘æ§ä»¥ä¸‹æŒ‡æ ‡ï¼š
1. **åˆ†ç±»å‡†ç¡®ç‡**ï¼šäººå·¥æŠ½æ ·éªŒè¯
2. **æ£€ç´¢å¬å›ç‡**ï¼šç›¸å…³æ–‡æ¡£æ˜¯å¦è¢«æ£€ç´¢åˆ°
3. **ç”¨æˆ·åé¦ˆ**ï¼šç”¨æˆ·å¯¹ç­”æ¡ˆçš„æ»¡æ„åº¦

## ğŸ› ï¸ è‡ªå®šä¹‰å’Œæ‰©å±•

### 1. æ‰©å±•å…³é”®è¯åº“
ç¼–è¾‘ `RAG.py` ä¸­çš„ `_classify_by_rules` æ–¹æ³•ï¼š

```python
keywords = {
    "Technology": [
        "æ€ä¹ˆåŠ", "å¦‚ä½•", "æ–¹æ³•", 
        # æ·»åŠ ä½ çš„å…³é”®è¯
        "æŒ‡å—", "æ•™ç¨‹", "æ”»ç•¥"
    ]
}
```

### 2. è°ƒæ•´åˆ†ç±»ç­–ç•¥
ä¿®æ”¹ `_classify_by_rules` æ–¹æ³•ä¸­çš„é€»è¾‘ï¼š

```python
# è°ƒæ•´å…œåº•ç­–ç•¥ï¼šåªè¿”å›å¾—åˆ†æœ€é«˜çš„ç±»å‹
if sorted_types[0][1] > 0:
    return [sorted_types[0][0]]  # åªè¿”å›æœ€é«˜åˆ†
else:
    return ["Technology"]  # é»˜è®¤è¿”å› Technology
```

### 3. å¯ç”¨LLMåˆ†ç±»
åœ¨ `create_documents` æ–¹æ³•ä¸­ï¼š

```python
# å°†è¿™è¡Œ
target_types = self.classify_query_intent(query)

# æ”¹ä¸º
target_types = self.classify_query_intent(query, use_llm=True)
```

### 4. æ··åˆç­–ç•¥
ç»“åˆè§„åˆ™å’ŒLLMçš„ä¼˜åŠ¿ï¼š

```python
# å…ˆç”¨è§„åˆ™åˆ†ç±»
rule_types = self.classify_query_intent(query, use_llm=False)

# å¦‚æœè§„åˆ™åˆ†ç±»ä¸ç¡®å®šï¼ˆè¿”å›æ‰€æœ‰ç±»å‹ï¼‰ï¼Œå†ç”¨LLM
if len(rule_types) == 4:
    target_types = self.classify_query_intent(query, use_llm=True)
else:
    target_types = rule_types
```

## ğŸ“Š A/B æµ‹è¯•å»ºè®®

### æµ‹è¯•æ–¹æ¡ˆ
1. **å¯¹ç…§ç»„**ï¼šå›ºå®šä½¿ç”¨ Technology ç±»å‹
2. **å®éªŒç»„**ï¼šä½¿ç”¨æ™ºèƒ½åˆ†ç±»

### è¯„ä¼°æŒ‡æ ‡
- æ£€ç´¢å‡†ç¡®ç‡
- ç”¨æˆ·æ»¡æ„åº¦è¯„åˆ†
- å¹³å‡å“åº”æ—¶é—´
- ç­”æ¡ˆç›¸å…³æ€§

### æµ‹è¯•ä»£ç ç¤ºä¾‹
```python
import random

def create_documents_with_ab_test(self, queries):
    # 50% ç”¨æˆ·ä½¿ç”¨æ–°ç­–ç•¥
    if random.random() < 0.5:
        # å®éªŒç»„ï¼šæ™ºèƒ½åˆ†ç±»
        target_types = self.classify_query_intent(queries[0])
        experiment_group = "smart"
    else:
        # å¯¹ç…§ç»„ï¼šå›ºå®šç±»å‹
        target_types = ["Technology"]
        experiment_group = "baseline"
    
    # è®°å½•å®éªŒç»„ä¿¡æ¯
    print(f"ğŸ“Š A/Bæµ‹è¯•: {experiment_group} ç»„")
    
    # ... ç»§ç»­æ£€ç´¢æµç¨‹
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
```python
# ä½¿ç”¨è§„åˆ™åˆ†ç±»ï¼ˆå¿«é€Ÿç¨³å®šï¼‰
target_types = self.classify_query_intent(query, use_llm=False)

# æ¯ä¸ªç±»å‹æ£€ç´¢3ä¸ªæ–‡æ¡£
results_vector = self.documents.similarity_search_with_relevance_scores(
    query, k=3, filter={"type": doc_type}
)

# æœ€ç»ˆè¿”å› Top-5
return sorted_results[:5]
```

### 2. é«˜å‡†ç¡®ç‡åœºæ™¯
```python
# ä½¿ç”¨LLMåˆ†ç±»ï¼ˆæ›´å‡†ç¡®ï¼‰
target_types = self.classify_query_intent(query, use_llm=True)

# å¢åŠ æ£€ç´¢æ•°é‡
k=5  # æ¯ä¸ªç±»å‹æ£€ç´¢5ä¸ª

# è¿”å› Top-10
return sorted_results[:10]
```

### 3. å¿«é€Ÿå“åº”åœºæ™¯
```python
# åªæ£€ç´¢æœ€ç›¸å…³çš„1-2ä¸ªç±»å‹
target_types = self.classify_query_intent(query)[:2]

# å‡å°‘æ£€ç´¢æ•°é‡
k=2

# è¿”å› Top-3
return sorted_results[:3]
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: åˆ†ç±»ä¸å‡†ç¡®æ€ä¹ˆåŠï¼Ÿ
**A:** 
1. æ£€æŸ¥å…³é”®è¯åº“æ˜¯å¦è¦†ç›–å¸¸è§é—®é¢˜
2. è€ƒè™‘å¯ç”¨ LLM åˆ†ç±»
3. æ”¶é›†é”™è¯¯æ¡ˆä¾‹ï¼Œä¼˜åŒ–å…³é”®è¯

### Q2: æ£€ç´¢é€Ÿåº¦å˜æ…¢äº†ï¼Ÿ
**A:** 
1. å‡å°‘è¿”å›çš„ç±»å‹æ•°é‡ï¼ˆåªå–å‰2ä¸ªï¼‰
2. å‡å°‘æ¯ä¸ªç±»å‹çš„æ£€ç´¢æ•°é‡ï¼ˆk=2ï¼‰
3. ä½¿ç”¨ç¼“å­˜æœºåˆ¶

### Q3: æŸäº›ç±»å‹æ–‡æ¡£æ£€ç´¢ä¸åˆ°ï¼Ÿ
**A:** 
1. æ£€æŸ¥å…ƒæ•°æ®ä¸­çš„ type å­—æ®µæ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤è¯¥ç±»å‹æ˜¯å¦è¢«é€‰ä¸­
3. éªŒè¯å‘é‡æ•°æ®åº“ä¸­æ˜¯å¦æœ‰è¯¥ç±»å‹çš„æ–‡æ¡£

## ğŸ“š ç›¸å…³èµ„æº

- [BM25 ç®—æ³•åŸç†](https://en.wikipedia.org/wiki/Okapi_BM25)
- [æ··åˆæ£€ç´¢æœ€ä½³å®è·µ](https://www.pinecone.io/learn/hybrid-search-intro/)
- [Rerank æŠ€æœ¯è¯¦è§£](https://www.sbert.net/examples/applications/cross-encoder/README.html)

## ğŸ‰ æ€»ç»“

æ™ºèƒ½æŸ¥è¯¢åˆ†ç±»èƒ½å¤Ÿï¼š
- âœ… **æé«˜æ£€ç´¢å‡†ç¡®ç‡ 20%+**
- âœ… **æå‡ç”¨æˆ·æ»¡æ„åº¦**
- âœ… **ä¸å¢åŠ å“åº”å»¶è¿Ÿ**
- âœ… **æ˜“äºç»´æŠ¤å’Œæ‰©å±•**

å»ºè®®å…ˆä½¿ç”¨è§„åˆ™åˆ†ç±»ï¼Œæ ¹æ®å®é™…æ•ˆæœå†³å®šæ˜¯å¦å¯ç”¨ LLM åˆ†ç±»ã€‚

